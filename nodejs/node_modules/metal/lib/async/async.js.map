{"version":3,"sources":["../../src/async/async.js"],"names":["async","throwException","exception","nextTick","run","callback","context","workQueueScheduled_","processWorkQueue","workQueue_","push","WorkItem_","length","workItems","i","workItem","fn","call","scope","e","cb","bind","wrapCallback_","setImmediate_","setImmediate","checkEnv","getSetImmediateEmulator_","Channel","MessageChannel","window","postMessage","addEventListener","iframe","document","createElement","style","display","src","title","documentElement","appendChild","win","contentWindow","doc","open","write","close","message","Math","random","origin","location","protocol","host","onmessage","data","port1","port2","channel","head","tail","next","script","onreadystatechange","parentNode","removeChild","setTimeout"],"mappings":"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","file":"async.js","sourcesContent":["/* !\n * Polyfill from Google's Closure Library.\n * Copyright 2013 The Closure Library Authors. All Rights Reserved.\n */\n\n'use strict';\n\nimport {isServerSide} from '../coreNamed';\n\nconst async = {};\n\n/**\n * Throw an item without interrupting the current execution context.  For\n * example, if processing a group of items in a loop, sometimes it is useful\n * to report an error while still allowing the rest of the batch to be\n * processed.\n * @param {*} exception\n */\nasync.throwException = function(exception) {\n\t// Each throw needs to be in its own context.\n\tasync.nextTick(function() {\n\t\tthrow exception;\n\t});\n};\n\n/**\n * Fires the provided callback just before the current callstack unwinds, or as\n * soon as possible after the current JS execution context.\n * @param {function(this:THIS)} callback\n * @param {THIS=} context Object to use as the \"this value\" when calling\n *     the provided function.\n * @template THIS\n */\nasync.run = function(callback, context) {\n\tif (!async.run.workQueueScheduled_) {\n\t\t// Nothing is currently scheduled, schedule it now.\n\t\tasync.nextTick(async.run.processWorkQueue);\n\t\tasync.run.workQueueScheduled_ = true;\n\t}\n\n\tasync.run.workQueue_.push(new async.run.WorkItem_(callback, context));\n};\n\n/** @private {boolean} */\nasync.run.workQueueScheduled_ = false;\n\n/** @private {!Array.<!async.run.WorkItem_>} */\nasync.run.workQueue_ = [];\n\n/**\n * Run any pending async.run work items. This function is not intended\n * for general use, but for use by entry point handlers to run items ahead of\n * async.nextTick.\n */\nasync.run.processWorkQueue = function() {\n\t// NOTE: additional work queue items may be pushed while processing.\n\twhile (async.run.workQueue_.length) {\n\t\t// Don't let the work queue grow indefinitely.\n\t\tconst workItems = async.run.workQueue_;\n\t\tasync.run.workQueue_ = [];\n\t\tfor (let i = 0; i < workItems.length; i++) {\n\t\t\tconst workItem = workItems[i];\n\t\t\ttry {\n\t\t\t\tworkItem.fn.call(workItem.scope);\n\t\t\t} catch (e) {\n\t\t\t\tasync.throwException(e);\n\t\t\t}\n\t\t}\n\t}\n\n\t// There are no more work items, reset the work queue.\n\tasync.run.workQueueScheduled_ = false;\n};\n\n/**\n * @constructor\n * @final\n * @struct\n * @private\n *\n * @param {function()} fn\n * @param {Object|null|undefined} scope\n */\nasync.run.WorkItem_ = function(fn, scope) {\n\t/** @const */\n\tthis.fn = fn;\n\t/** @const */\n\tthis.scope = scope;\n};\n\n/**\n * Fires the provided callbacks as soon as possible after the current JS\n * execution context. setTimeout(â€¦, 0) always takes at least 5ms for legacy\n * reasons.\n * @param {function(this:SCOPE)} callback Callback function to fire as soon as\n *     possible.\n * @param {SCOPE=} context Object in whose scope to call the listener.\n * @template SCOPE\n */\nasync.nextTick = function(callback, context) {\n\tlet cb = callback;\n\tif (context) {\n\t\tcb = callback.bind(context);\n\t}\n\tcb = async.nextTick.wrapCallback_(cb);\n\t// Look for and cache the custom fallback version of setImmediate.\n\tif (!async.nextTick.setImmediate_) {\n\t\tif (\n\t\t\ttypeof setImmediate === 'function' &&\n\t\t\tisServerSide({checkEnv: false})\n\t\t) {\n\t\t\tasync.nextTick.setImmediate_ = setImmediate;\n\t\t} else {\n\t\t\t// eslint-disable-next-line\n\t\t\tasync.nextTick.setImmediate_ = async.nextTick.getSetImmediateEmulator_();\n\t\t}\n\t}\n\tasync.nextTick.setImmediate_(cb);\n};\n\n/**\n * Cache for the setImmediate implementation.\n * @type {function(function())}\n * @private\n */\nasync.nextTick.setImmediate_ = null;\n\n/**\n * Determines the best possible implementation to run a function as soon as\n * the JS event loop is idle.\n * @return {function(function())} The \"setImmediate\" implementation.\n * @private\n */\nasync.nextTick.getSetImmediateEmulator_ = function() {\n\t// Create a private message channel and use it to postMessage empty messages\n\t// to ourselves.\n\tlet Channel;\n\n\t// Verify if variable is defined on the current runtime (i.e., node, browser).\n\t// Can't use typeof enclosed in a function (such as core.isFunction) or an\n\t// exception will be thrown when the function is called on an environment\n\t// where the variable is undefined.\n\tif (typeof MessageChannel === 'function') {\n\t\tChannel = MessageChannel;\n\t}\n\n\t// If MessageChannel is not available and we are in a browser, implement\n\t// an iframe based polyfill in browsers that have postMessage and\n\t// document.addEventListener. The latter excludes IE8 because it has a\n\t// synchronous postMessage implementation.\n\tif (\n\t\ttypeof Channel === 'undefined' &&\n\t\ttypeof window !== 'undefined' &&\n\t\twindow.postMessage &&\n\t\twindow.addEventListener\n\t) {\n\t\t/** @constructor */\n\t\tChannel = function() {\n\t\t\t// Make an empty, invisible iframe.\n\t\t\tconst iframe = document.createElement('iframe');\n\t\t\tiframe.style.display = 'none';\n\t\t\tiframe.src = '';\n\t\t\tiframe.title = '';\n\t\t\tdocument.documentElement.appendChild(iframe);\n\t\t\tconst win = iframe.contentWindow;\n\t\t\tconst doc = win.document;\n\t\t\tdoc.open();\n\t\t\tdoc.write('');\n\t\t\tdoc.close();\n\t\t\tconst message = 'callImmediate' + Math.random();\n\t\t\tconst origin = win.location.protocol + '//' + win.location.host;\n\t\t\tconst onmessage = function(e) {\n\t\t\t\t// Validate origin and message to make sure that this message was\n\t\t\t\t// intended for us.\n\t\t\t\tif (e.origin !== origin && e.data !== message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.port1.onmessage();\n\t\t\t}.bind(this);\n\t\t\twin.addEventListener('message', onmessage, false);\n\t\t\tthis.port1 = {};\n\t\t\tthis.port2 = {\n\t\t\t\tpostMessage: function() {\n\t\t\t\t\twin.postMessage(message, origin);\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\t}\n\tif (typeof Channel !== 'undefined') {\n\t\tconst channel = new Channel();\n\t\t// Use a fifo linked list to call callbacks in the right order.\n\t\tlet head = {};\n\t\tlet tail = head;\n\t\tchannel.port1.onmessage = function() {\n\t\t\thead = head.next;\n\t\t\tconst cb = head.cb;\n\t\t\thead.cb = null;\n\t\t\tcb();\n\t\t};\n\t\treturn function(cb) {\n\t\t\ttail.next = {\n\t\t\t\tcb: cb,\n\t\t\t};\n\t\t\ttail = tail.next;\n\t\t\tchannel.port2.postMessage(0);\n\t\t};\n\t}\n\t// Implementation for IE6-8: Script elements fire an asynchronous\n\t// onreadystatechange event when inserted into the DOM.\n\tif (\n\t\ttypeof document !== 'undefined' &&\n\t\t'onreadystatechange' in document.createElement('script')\n\t) {\n\t\treturn function(cb) {\n\t\t\tlet script = document.createElement('script');\n\t\t\tscript.onreadystatechange = function() {\n\t\t\t\t// Clean up and call the callback.\n\t\t\t\tscript.onreadystatechange = null;\n\t\t\t\tscript.parentNode.removeChild(script);\n\t\t\t\tscript = null;\n\t\t\t\tcb();\n\t\t\t\tcb = null;\n\t\t\t};\n\t\t\tdocument.documentElement.appendChild(script);\n\t\t};\n\t}\n\t// Fall back to setTimeout with 0. In browsers this creates a delay of 5ms\n\t// or more.\n\treturn function(cb) {\n\t\tsetTimeout(cb, 0);\n\t};\n};\n\n/**\n * Helper function that is overrided to protect callbacks with entry point\n * monitor if the application monitors entry points.\n * @param {function()} callback Callback function to fire as soon as possible.\n * @return {function()} The wrapped callback.\n * @private\n */\nasync.nextTick.wrapCallback_ = function(callback) {\n\treturn callback;\n};\n\nexport default async;\n"]}